<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicció COVID-19 Espanya: Funció 'estimació_pandèmia' Ajustable</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 15px;
            text-align: center;
        }
        h2 {
            color: #007bff;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.2em;
        }
        .controls {
            margin-bottom: 25px;
            background-color: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80%;
            max-width: 600px;
        }
        .control-group {
            width: 100%;
            margin-bottom: 20px;
            text-align: center;
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        label {
            font-size: 1.1em;
            margin-bottom: 10px;
            display: block;
            text-align: center;
        }
        input[type="range"] {
            width: 80%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #007bff;
            border-radius: 50%;
            cursor: grab;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #007bff;
            border-radius: 50%;
            cursor: grab;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        #dayValue, #betaValue {
            font-weight: bold;
            color: #007bff;
            margin-left: 8px;
            font-size: 1.2em;
        }
        #sirGraph {
            width: 90%;
            max-width: 900px;
            height: 600px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>Predicció d'Infectats en la Pandèmia de COVID-19 (Espanya)</h1>
    <h2>Comparació entre l'històric real i una evolució hipotètica</h2>

    <div class="controls">
        <div class="control-group">
            <label for="dayRange">Dia d'Inici de Projecció (Dia 0 = 25 Feb 2020): <span id="dayValue"></span></label>
            <input type="range" id="dayRange" min="0" step="1" value="150">
        </div>
        <div class="control-group">
            <label for="betaRange">Valor de Beta per a la Projecció: <span id="betaValue"></span></label>
            <input type="range" id="betaRange" min="0.01" max="0.5" step="0.001" value="0.108">
        </div>
    </div>

    <div id="sirGraph"></div>

    <script>
        // Variables per als elements del DOM, ara amb noms en català
        const rangDia = document.getElementById('dayRange');
        const valorDiaSpan = document.getElementById('dayValue');
        const rangBeta = document.getElementById('betaRange');
        const valorBetaSpan = document.getElementById('betaValue');
        const graficSIRDiv = document.getElementById('sirGraph');

        const llista_casos_hist = [4, 7, 2, 17, 13, 39, 35, 45, 57, 37, 141, 100, 173, 400, 622, 582, 1478, 1478, 1159, 1407, 2144, 1806, 2162, 4053, 2447, 4964, 3394, 6368, 4749, 9630, 8271, 7933, 7516, 6875, 7846, 7967, 8195, 7947, 7134, 6969, 5478, 5029, 5267, 6278, 5002, 5051, 4754, 3804, 3268, 2442, 5103, 7304, 5891, 887, 6948, 1536, 3968, 4211, 4635, 2915, 1729, 1831, 1308, 2144, 518, 1781, 1366, 884, 545, 1318, 996, 1122, 1410, 721, 772, 3086, 594, 661, 849, 643, 515, 454, 454, 431, 518, 482, 1787, 466, 482, 859, 824, 824, 658, 664, 251, 159, 294, 394, 334, 318, 332, 240, 167, 249, 314, 427, 502, 396, 323, 181, 219, 355, 585, 307, 363, 334, 232, 248, 334, 400, 419, 564, 301, 200, 301, 388, 444, 442, 415, 415, 415, 341, 383, 543, 852, 682, 682, 682, 666, 875, 1361, 1400, 1527, 1527, 1527, 1358, 1357, 2615, 2255, 2120, 2120, 2120, 1828, 2031, 2789, 3092, 2844, 2844, 2844, 5760, 2953, 4088, 4507, 2873, 2873, 2873, 3632, 3172, 7550, 5479, 5423, 5423, 5423, 5114, 6671, 7039, 8148, 6461, 6461, 6461, 7117, 7296, 9658, 9779, 7857, 7857, 7857, 8115, 8581, 8959, 10476, 8853, 8853, 8853, 8964, 8866, 10764, 12183, 9135, 9135, 9135, 9437, 11193, 11291, 14389, 10476, 10476, 10476, 10799, 11289, 10653, 12272, 10595, 10595, 10595, 10461, 10461, 9419, 11325, 7827, 7827, 7827, 11998, 10491, 12423, 12788, 9285, 9285, 9285, 7118, 11970, 13318, 15186, 12630, 12630, 12630, 13873, 16973, 20986, 19851, 17396, 17396, 17396, 18418, 19765, 23580, 25595, 18340, 18340, 18340, 18669, 25042, 21908, 22516, 17462, 17462, 17462, 18246, 18246, 19511, 21371, 12758, 12758, 12758, 13159, 15318, 16233, 15156, 8629, 8629, 8629, 12228, 10222, 12289, 10853, 6660, 6660, 6660, 8257, 9331, 10127, 8745, 5894, 5894, 5894, 4886, 4886, 7955, 10519, 7103, 7103, 7103, 10328, 11078, 12131, 11815, 7338, 7338, 7338, 10654, 12386, 12662, 6116, 6116, 6116, 6116, 14089, 16716, 18047, 7645, 7645, 7645, 7645, 23700, 21180, 21180, 25456, 20474, 20474, 20474, 25438, 38869, 35878, 40197, 28096, 28096, 28096, 34291, 41576, 44357, 42885, 31274, 31274, 31274, 36435, 40285, 34899, 38118, 26562, 26562, 26562, 29064, 31596, 29960, 28565, 15698, 15698, 15698, 16402, 18114, 17853, 14581, 10084, 10084, 10084, 10057, 10829, 14515, 11435, 6950, 6950, 6950, 7461, 9212, 9568, 8341, 5326, 5326, 5326, 3068, 3068, 6037, 6654, 3986, 3986, 3986, 4012, 7119, 6255, 5348, 3786, 3786, 3786, 4962, 6092, 6216, 4118, 4118, 4118, 4118, 5516, 6710, 6710, 7586, 5167, 5167, 5167, 4994, 8534, 7041, 4786, 4786, 5180, 5180, 6623, 8788, 9901, 10875, 7581, 7581, 7581, 6292, 10474, 9663, 10598, 7024, 7024, 7024, 8859, 8859, 10814, 11731, 6617, 6617, 6617, 7665, 8665, 10143, 9135, 5451, 5451, 5451, 4515, 6317, 7960, 8186, 4661, 4661, 4661, 4941, 6418, 5701, 6347, 3687, 3687, 3687, 3988, 6080, 5733, 4792, 3689, 3689, 3689, 5359, 5007, 5290, 5482, 3244, 3244, 3244, 4388, 4984, 5250, 4969, 3181, 3181, 3181, 3504, 4427, 14004, 4142, 2722, 2722, 2722, 3432, 3832, 4197, 4214, 2403, 2403, 2403, 4040, 4341, 4507, 4924, 3393, 3393, 3393, 7091, 9227, 12345, 12563, 10869, 10869, 10869, 14137, 17384, 17317, 21879, 11311, 11311, 11311, 43960, 26390, 27688, 31060, 20543, 20543, 20543, 27286, 30587, 29535, 31171, 20542, 20542, 20542, 26399, 27149, 26689, 24753, 18646, 18646, 18646, 20327, 21874, 21387, 21561, 13213, 13213, 13213, 15680, 17023, 17410, 15657, 8575, 8575, 8575, 14336, 11956, 12445, 12450, 7966, 7966, 7966, 10072, 10781, 7115, 9489, 5163, 5163, 5163, 7767, 6818, 9561, 6311, 3119, 3119, 3119, 5528, 5618, 4763, 4440, 2601, 2601, 2601, 3261, 3723, 4075, 3222, 1996, 1996, 1996, 2450, 2840, 3031, 2746, 1680, 1680, 1680, 2290, 2761, 2400, 2037, 1424, 1424, 1424, 1801, 2303, 1807, 2309, 1276, 1276, 1276, 1379, 1379, 1932, 2248, 1497, 1497, 1497, 1889, 2528, 1881, 2556, 1495, 1495, 1495, 1926, 2532, 2212, 2261, 1455, 1455, 1455, 1455, 2287, 3291, 3093, 2139, 2139, 2139, 3230, 3230, 4286, 4353, 3266, 3266, 3266, 4091, 6667, 6315, 6636, 5292, 5292, 5292, 6777, 8527, 9258, 9912, 7637, 7637, 7637, 10261, 10536, 14500, 13738, 10952, 10952, 10952, 10952, 13206, 13206, 17095, 16601, 16601, 16601, 26136, 27140, 28900, 33359, 26568, 26568, 26568, 49823, 60041, 72912, 53655, 53655, 53655, 53655, 99671, 100760, 161688, 93192, 93192, 93192, 93192, 117775, 137180, 121220, 121220, 97465, 97465, 97465, 134942, 179125, 159161, 162508, 110489, 110489, 110489, 94472, 157941, 157447, 141095, 101811, 101811, 101811, 114877, 133553, 130888, 118922, 60708, 60708, 60708, 77873, 86222, 74368, 48939, 48939, 48939, 48939, 43831, 62839, 53055, 49004, 22902, 22902, 22902, 34380, 37108, 34213, 30615, 16259, 16259, 16259, 22193, 33912, 35892, 27527, 14640, 14640, 14640, 14640, 18803, 23140, 22400, 11999, 11999, 11999, 23149, 21936, 22615, 19849];
        const S_hist = [47370000, 47369996, 47369989, 47369987, 47369970, 47369957, 47369918, 47369883, 47369838, 47369781, 47369744, 47369603, 47369503, 47369330, 47368930, 47368308, 47367726, 47366248, 47364770, 47363611, 47362204, 47360060, 47358254, 47356092, 47352039, 47349592, 47344628, 47341234, 47334866, 47330117, 47320487, 47312216, 47304283, 47296767, 47289892, 47282046, 47274079, 47265884, 47257937, 47250803, 47243834, 47238356, 47233327, 47228060, 47221782, 47216780, 47211729, 47206975, 47203171, 47199903, 47197461, 47192358, 47185054, 47179163, 47178276, 47171328, 47169792, 47165824, 47161613, 47156978, 47154063, 47152334, 47150503, 47149195, 47147051, 47146533, 47144752, 47143386, 47142502, 47141957, 47140639, 47139643, 47138521, 47137111, 47136390, 47135618, 47132532, 47131938, 47131277, 47130428, 47129785, 47129270, 47128816, 47128362, 47127931, 47127413, 47126931, 47125144, 47124678, 47124196, 47123337, 47122513, 47121689, 47121031, 47120367, 47120116, 47119957, 47119663, 47119269, 47118935, 47118617, 47118285, 47118045, 47117878, 47117629, 47117315, 47116888, 47116386, 47115990, 47115667, 47115486, 47115267, 47114912, 47114327, 47114020, 47113657, 47113323, 47113091, 47112843, 47112509, 47112109, 47111690, 47111126, 47110825, 47110625, 47110324, 47109936, 47109492, 47109050, 47108635, 47108220, 47107805, 47107464, 47107081, 47106538, 47105686, 47105004, 47104322, 47103640, 47102974, 47102099, 47100738, 47099338, 47097811, 47096284, 47094757, 47093399, 47092042, 47089427, 47087172, 47085052, 47082932, 47080812, 47078984, 47076953, 47074164, 47071072, 47068228, 47065384, 47062540, 47056780, 47053827, 47049739, 47045232, 47042359, 47039486, 47036613, 47032981, 47029809, 47022259, 47016780, 47011357, 47005934, 47000511, 46995397, 46988726, 46981687, 46973539, 46967078, 46960617, 46954156, 46947039, 46939743, 46930085, 46920306, 46912449, 46904592, 46896735, 46888620, 46880039, 46871080, 46860604, 46851751, 46842898, 46834045, 46825081, 46816215, 46805451, 46793268, 46784133, 46774998, 46765863, 46756426, 46745233, 46733942, 46719553, 46709077, 46698601, 46688125, 46677326, 46666037, 46655384, 46643112, 46632517, 46621922, 46611327, 46600866, 46590405, 46580986, 46569661, 46561834, 46554007, 46546180, 46534182, 46523691, 46511268, 46498480, 46489195, 46479910, 46470625, 46463507, 46451537, 46438219, 46423033, 46410403, 46397773, 46385143, 46371270, 46354297, 46333311, 46313460, 46296064, 46278668, 46261272, 46242854, 46223089, 46199509, 46173914, 46155574, 46137234, 46118894, 46100225, 46075183, 46053275, 46030759, 46013297, 45995835, 45978373, 45960127, 45941881, 45922370, 45900999, 45888241, 45875483, 45862725, 45849566, 45834248, 45818015, 45802859, 45794230, 45785601, 45776972, 45764744, 45754522, 45742233, 45731380, 45724720, 45718060, 45711400, 45703143, 45693812, 45683685, 45674940, 45669046, 45663152, 45657258, 45652372, 45647486, 45639531, 45629012, 45621909, 45614806, 45607703, 45597375, 45586297, 45574166, 45562351, 45555013, 45547675, 45540337, 45529683, 45517297, 45504635, 45498519, 45492403, 45486287, 45480171, 45466082, 45449366, 45431319, 45423674, 45416029, 45408384, 45400739, 45377039, 45355859, 45334679, 45309223, 45288749, 45268275, 45247801, 45222363, 45183494, 45147616, 45107419, 45079323, 45051227, 45023131, 44988840, 44947264, 44902907, 44860022, 44828748, 44797474, 44766200, 44729765, 44689480, 44654581, 44616463, 44589901, 44563339, 44536777, 44507713, 44476117, 44446157, 44417592, 44401894, 44386196, 44370498, 44354096, 44335982, 44318129, 44303548, 44293464, 44283380, 44273296, 44263239, 44252410, 44237895, 44226460, 44219510, 44212560, 44205610, 44198149, 44188937, 44179369, 44171028, 44165702, 44160376, 44155050, 44151982, 44148914, 44142877, 44136223, 44132237, 44128251, 44124265, 44120253, 44113134, 44106879, 44101531, 44097745, 44093959, 44090173, 44085211, 44079119, 44072903, 44068785, 44064667, 44060549, 44056431, 44050915, 44044205, 44037495, 44029909, 44024742, 44019575, 44014408, 44009414, 44000880, 43993839, 43989053, 43984267, 43979087, 43973907, 43967284, 43958496, 43948595, 43937720, 43930139, 43922558, 43914977, 43908685, 43898211, 43888548, 43877950, 43870926, 43863902, 43856878, 43848019, 43839160, 43828346, 43816615, 43809998, 43803381, 43796764, 43789099, 43780434, 43770291, 43761156, 43755705, 43750254, 43744803, 43740288, 43733971, 43726011, 43717825, 43713164, 43708503, 43703842, 43698901, 43692483, 43686782, 43680435, 43676748, 43673061, 43669374, 43665386, 43659306, 43653573, 43648781, 43645092, 43641403, 43637714, 43632355, 43627348, 43622058, 43616576, 43613332, 43610088, 43606844, 43602456, 43597472, 43592222, 43587253, 43584072, 43580891, 43577710, 43574206, 43569779, 43555775, 43551633, 43548911, 43546189, 43543467, 43540035, 43536203, 43532006, 43527792, 43525389, 43522986, 43520583, 43516543, 43512202, 43507695, 43502771, 43499378, 43495985, 43492592, 43485501, 43476274, 43463929, 43451366, 43440497, 43429628, 43418759, 43404622, 43387238, 43369921, 43348042, 43336731, 43325420, 43314109, 43270149, 43243759, 43216071, 43185011, 43164468, 43143925, 43123382, 43096096, 43065509, 43035974, 43004803, 42984261, 42963719, 42943177, 42916778, 42889629, 42862940, 42838187, 42819541, 42800895, 42782249, 42761922, 42740048, 42718661, 42697100, 42683887, 42670674, 42657461, 42641781, 42624758, 42607348, 42591691, 42583116, 42574541, 42565966, 42551630, 42539674, 42527229, 42514779, 42506813, 42498847, 42490881, 42480809, 42470028, 42462913, 42453424, 42448261, 42443098, 42437935, 42430168, 42423350, 42413789, 42407478, 42404359, 42401240, 42398121, 42392593, 42386975, 42382212, 42377772, 42375171, 42372570, 42369969, 42366708, 42362985, 42358910, 42355688, 42353692, 42351696, 42349700, 42347250, 42344410, 42341379, 42338633, 42336953, 42335273, 42333593, 42331303, 42328542, 42326142, 42324105, 42322681, 42321257, 42319833, 42318032, 42315729, 42313922, 42311613, 42310337, 42309061, 42307785, 42306406, 42305027, 42303095, 42300847, 42299350, 42297853, 42296356, 42294467, 42291939, 42290058, 42287502, 42286007, 42284512, 42283017, 42281091, 42278559, 42276347, 42274086, 42272631, 42271176, 42269721, 42268266, 42265979, 42262688, 42259595, 42257456, 42255317, 42253178, 42249948, 42246718, 42242432, 42238079, 42234813, 42231547, 42228281, 42224190, 42217523, 42211208, 42204572, 42199280, 42193988, 42188696, 42181919, 42173392, 42164134, 42154222, 42146585, 42138948, 42131311, 42121050, 42110514, 42096014, 42082276, 42071324, 42060372, 42049420, 42038468, 42025262, 42012056, 41994961, 41978360, 41961759, 41945158, 41919022, 41891882, 41862982, 41829623, 41803055, 41776487, 41749919, 41700096, 41640055, 41567143, 41513488, 41459833, 41406178, 41352523, 41252852, 41152092, 40990404, 40897212, 40804020, 40710828, 40617636, 40499861, 40362681, 40241461, 40120241, 40022776, 39925311, 39827846, 39692904, 39513779, 39354618, 39192110, 39081621, 38971132, 38860643, 38766171, 38608230, 38450783, 38309688, 38207877, 38106066, 38004255, 37889378, 37755825, 37624937, 37506015, 37445307, 37384599, 37323891, 37246018, 37159796, 37085428, 37036489, 36987550, 36938611, 36889672, 36845841, 36783002, 36729947, 36680943, 36658041, 36635139, 36612237, 36577857, 36540749, 36506536, 36475921, 36459662, 36443403, 36427144, 36404951, 36371039, 36335147, 36307620, 36292980, 36278340, 36263700, 36249060, 36230257, 36207117, 36184717, 36172718, 36160719, 36148720, 36125571, 36103635, 36081020];
        const I_hist = [0, 4, 11, 13, 30, 43, 82, 117, 162, 219, 256, 393, 486, 657, 1040, 1649, 2192, 3635, 5068, 6170, 7540, 9543, 11249, 13238, 16891, 18716, 23098, 25014, 29904, 33494, 41717, 47844, 53971, 59325, 62147, 67546, 70549, 75350, 76929, 79314, 76653, 73860, 70956, 68707, 68110, 65266, 62350, 58909, 54766, 50900, 46373, 45998, 48273, 48897, 43506, 45452, 41937, 41151, 41558, 42925, 43398, 40024, 34551, 29968, 31225, 24795, 25040, 22438, 19111, 15021, 13424, 12691, 11982, 12084, 10661, 10915, 12220, 11448, 11225, 11529, 10854, 10373, 9705, 8749, 8459, 8205, 5601, 6794, 6599, 6232, 6448, 6757, 7127, 7331, 7564, 7297, 6974, 5481, 5409, 5261, 4720, 4228, 3644, 3153, 2738, 2801, 3069, 3277, 3279, 3268, 3131, 3018, 3133, 3551, 3609, 3658, 3565, 3295, 3147, 3158, 3377, 3577, 3786, 3502, 3395, 3333, 3387, 3599, 3793, 3874, 3889, 3885, 3662, 3744, 4087, 4638, 4932, 5170, 5410, 5661, 6121, 7067, 8126, 9270, 10254, 10929, 11605, 12280, 14213, 15802, 17047, 17806, 18526, 18827, 19331, 20593, 22327, 23814, 24043, 24632, 28272, 29105, 31073, 33752, 34594, 34678, 34459, 35247, 35575, 40281, 40000, 42470, 43805, 44721, 46962, 50760, 54926, 59442, 62731, 61642, 62624, 64318, 66191, 70426, 75091, 76277, 77095, 76804, 78458, 80578, 83076, 86435, 87992, 87187, 86261, 87368, 88377, 91284, 95352, 95906, 96082, 94741, 95325, 97665, 100103, 105528, 107138, 106850, 105143, 106807, 108961, 110479, 113314, 112716, 112020, 108226, 108211, 108196, 107139, 107665, 104203, 101377, 96932, 98335, 98231, 100059, 102386, 101210, 101076, 99036, 98327, 102470, 107961, 111149, 113288, 113495, 113337, 117925, 125613, 137314, 150047, 155473, 159551, 161761, 167549, 174684, 185634, 197356, 198723, 196077, 194566, 195839, 203485, 207997, 212095, 209792, 203674, 195541, 195447, 195353, 196524, 199226, 186942, 177792, 168034, 163731, 161587, 160358, 157268, 147651, 136769, 124027, 123497, 120961, 120492, 118186, 109528, 99955, 91459, 91087, 91789, 93287, 89804, 85476, 79081, 74122, 72348, 70574, 71869, 74131, 71903, 68879, 67237, 71671, 76855, 83092, 90021, 92473, 91856, 88675, 92226, 97509, 103068, 98856, 93894, 87879, 82180, 88931, 98309, 109018, 106009, 101268, 96251, 97780, 115364, 130428, 145492, 156859, 160617, 163044, 175873, 193666, 224890, 253123, 269620, 276536, 283452, 286092, 299909, 321011, 344894, 362341, 354746, 350142, 341219, 349558, 361747, 368550, 372377, 357363, 339568, 323245, 321035, 321357, 320043, 312173, 287586, 268385, 245965, 235805, 227357, 218648, 204165, 182653, 162777, 144296, 138655, 133786, 132603, 127636, 116472, 105569, 97938, 95315, 94443, 93927, 92211, 86708, 77519, 71410, 67528, 63646, 62733, 61926, 56700, 51118, 46763, 45449, 47242, 48171, 50451, 51169, 48918, 46050, 47026, 49132, 51362, 51468, 48467, 46330, 45100, 46830, 49754, 52678, 55302, 54377, 53328, 54377, 55253, 59669, 62592, 61862, 59938, 58408, 56002, 57458, 61079, 65813, 71694, 70741, 71281, 74076, 75582, 80876, 85359, 89334, 87570, 84693, 80842, 82120, 83398, 86631, 92070, 88213, 85167, 81186, 81827, 83468, 86587, 86863, 83455, 78092, 71812, 69710, 69410, 70753, 71274, 67270, 61788, 57314, 56804, 57771, 58021, 59853, 57223, 52950, 48451, 47778, 49197, 50269, 50120, 47391, 45379, 42721, 44393, 45713, 47316, 48810, 45974, 43485, 41937, 42636, 43931, 45492, 45102, 43276, 41167, 38866, 39126, 40309, 51069, 50823, 48561, 46033, 43786, 44037, 44688, 45704, 46414, 44390, 32789, 31050, 32368, 33987, 35772, 37264, 36825, 36021, 35200, 39888, 46712, 56654, 65177, 71705, 78067, 84012, 94756, 108747, 122671, 137459, 139543, 138509, 137257, 170348, 185869, 202688, 219611, 222770, 225996, 224660, 240635, 259911, 278135, 265346, 259498, 252352, 241834, 247690, 254296, 260442, 257909, 245968, 235079, 222554, 222339, 223671, 224516, 219678, 205742, 192266, 180726, 177760, 176137, 174901, 170231, 156932, 144120, 131134, 132257, 131000, 130232, 127002, 117945, 108501, 100810, 102307, 104513, 103053, 98206, 91413, 84131, 76844, 76645, 75497, 77092, 73331, 65669, 61673, 55303, 55668, 56123, 55723, 52396, 48179, 41219, 37509, 37651, 38255, 39211, 36905, 33283, 30516, 28072, 27921, 28160, 28590, 28075, 26032, 23637, 22095, 22389, 23154, 23558, 23145, 21729, 20122, 18800, 18921, 19544, 19671, 19690, 18205, 17081, 16320, 16275, 16230, 16738, 17185, 16379, 16069, 15257, 15870, 17122, 17727, 18904, 19020, 18583, 17830, 18259, 19294, 20009, 20381, 19308, 18882, 17781, 17741, 18533, 20329, 21496, 21103, 21030, 20908, 22683, 24458, 27289, 30187, 31166, 31141, 31314, 33266, 37794, 41970, 45376, 47438, 48444, 49383, 52894, 58155, 64147, 69968, 70938, 72260, 73261, 78230, 83474, 92682, 99643, 102068, 103762, 104802, 108117, 113686, 119255, 126089, 132154, 134255, 137118, 152302, 168490, 186438, 208845, 222207, 235569, 245042, 278264, 321704, 378015, 405534, 432049, 456804, 477100, 550203, 624395, 759515, 802884, 836035, 856315, 895852, 959972, 1043497, 1111062, 1132611, 1129316, 1065093, 1069366, 1111116, 1197049, 1263018, 1307751, 1281060, 1270329, 1259598, 1256605, 1317081, 1377063, 1383216, 1305902, 1248552, 1187855, 1192243, 1215307, 1235706, 1260156, 1162923, 1066184, 985797, 961859, 946270, 918827, 852889, 768275, 686326, 616343, 599466, 601597, 593944, 565075, 501755, 450289, 424252, 409693, 397862, 383136, 369920, 323340, 286544, 253799, 253090, 264100, 277090, 270237, 247769, 228196, 212221, 210602, 213146, 220027, 220234, 198321, 174428, 158900, 167409, 174705, 182680];
        const R_hist = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 11, 13, 30, 43, 82, 117, 162, 219, 256, 397, 497, 670, 1070, 1692, 2274, 3752, 5230, 6389, 7796, 9940, 11746, 13908, 17961, 20408, 25372, 28766, 35134, 39883, 49513, 57784, 65717, 73233, 80108, 87954, 95921, 104116, 112063, 119197, 126166, 131644, 136673, 141940, 148218, 153220, 158271, 163025, 166829, 170097, 172539, 177642, 184946, 190837, 191724, 198672, 200208, 204176, 208387, 213022, 215937, 217666, 219497, 220805, 222949, 223467, 225248, 226614, 227498, 228043, 229361, 230357, 231479, 232889, 233610, 234382, 237468, 238062, 238723, 239572, 240215, 240730, 241184, 241638, 242069, 242587, 243069, 244856, 245322, 245804, 246663, 247487, 248311, 248969, 249633, 249884, 250043, 250337, 250731, 251065, 251383, 251715, 251955, 252122, 252371, 252685, 253112, 253614, 254010, 254333, 254514, 254733, 255088, 255673, 255980, 256343, 256677, 256909, 257157, 257491, 257891, 258310, 258874, 259175, 259375, 259676, 260064, 260508, 260950, 261365, 261780, 262195, 262536, 262919, 263462, 264314, 264996, 265678, 266360, 267026, 267901, 269262, 270662, 272189, 273716, 275243, 276601, 277958, 280573, 282828, 284948, 287068, 289188, 291016, 293047, 295836, 298928, 301772, 304616, 307460, 313220, 316173, 320261, 324768, 327641, 330514, 333387, 337019, 340191, 347741, 353220, 358643, 364066, 369489, 374603, 381274, 388313, 396461, 402922, 409383, 415844, 422961, 430257, 439915, 449694, 457551, 465408, 473265, 481380, 489961, 498920, 509396, 518249, 527102, 535955, 544919, 553785, 564549, 576732, 585867, 595002, 604137, 613574, 624767, 636058, 650447, 660923, 671399, 681875, 692674, 703963, 714616, 726888, 737483, 748078, 758673, 769134, 779595, 789014, 800339, 808166, 815993, 823820, 835818, 846309, 858732, 871520, 880805, 890090, 899375, 906493, 918463, 931781, 946967, 959597, 972227, 984857, 998730, 1015703, 1036689, 1056540, 1073936, 1091332, 1108728, 1127146, 1146911, 1170491, 1196086, 1214426, 1232766, 1251106, 1269775, 1294817, 1316725, 1339241, 1356703, 1374165, 1391627, 1409873, 1428119, 1447630, 1469001, 1481759, 1494517, 1507275, 1520434, 1535752, 1551985, 1567141, 1575770, 1584399, 1593028, 1605256, 1615478, 1627767, 1638620, 1645280, 1651940, 1658600, 1666857, 1676188, 1686315, 1695060, 1700954, 1706848, 1712742, 1717628, 1722514, 1730469, 1740988, 1748091, 1755194, 1762297, 1772625, 1783703, 1795834, 1807649, 1814987, 1822325, 1829663, 1840317, 1852703, 1865365, 1871481, 1877597, 1883713, 1889829, 1903918, 1920634, 1938681, 1946326, 1953971, 1961616, 1969261, 1992961, 2014141, 2035321, 2060777, 2081251, 2101725, 2122199, 2147637, 2186506, 2222384, 2262581, 2290677, 2318773, 2346869, 2381160, 2422736, 2467093, 2509978, 2541252, 2572526, 2603800, 2640235, 2680520, 2715419, 2753537, 2780099, 2806661, 2833223, 2862287, 2893883, 2923843, 2952408, 2968106, 2983804, 2999502, 3015904, 3034018, 3051871, 3066452, 3076536, 3086620, 3096704, 3106761, 3117590, 3132105, 3143540, 3150490, 3157440, 3164390, 3171851, 3181063, 3190631, 3198972, 3204298, 3209624, 3214950, 3218018, 3221086, 3227123, 3233777, 3237763, 3241749, 3245735, 3249747, 3256866, 3263121, 3268469, 3272255, 3276041, 3279827, 3284789, 3290881, 3297097, 3301215, 3305333, 3309451, 3313569, 3319085, 3325795, 3332505, 3340091, 3345258, 3350425, 3355592, 3360586, 3369120, 3376161, 3380947, 3385733, 3390913, 3396093, 3402716, 3411504, 3421405, 3432280, 3439861, 3447442, 3455023, 3461315, 3471789, 3481452, 3492050, 3499074, 3506098, 3513122, 3521981, 3530840, 3541654, 3553385, 3560002, 3566619, 3573236, 3580901, 3589566, 3599709, 3608844, 3614295, 3619746, 3625197, 3629712, 3636029, 3643989, 3652175, 3656836, 3661497, 3666158, 3671099, 3677517, 3683218, 3689565, 3693252, 3696939, 3700626, 3704614, 3710694, 3716427, 3721219, 3724908, 3728597, 3732286, 3737645, 3742652, 3747942, 3753424, 3756668, 3759912, 3763156, 3767544, 3772528, 3777778, 3782747, 3785928, 3789109, 3792290, 3795794, 3800221, 3814225, 3818367, 3821089, 3823811, 3826533, 3829965, 3833797, 3837994, 3842208, 3844611, 3847014, 3849417, 3853457, 3857798, 3862305, 3867229, 3870622, 3874015, 3877408, 3884499, 3893726, 3906071, 3918634, 3929503, 3940372, 3951241, 3965378, 3982762, 4000079, 4021958, 4033269, 4044580, 4055891, 4099851, 4126241, 4153929, 4184989, 4205532, 4226075, 4246618, 4273904, 4304491, 4334026, 4365197, 4385739, 4406281, 4426823, 4453222, 4480371, 4507060, 4531813, 4550459, 4569105, 4587751, 4608078, 4629952, 4651339, 4672900, 4686113, 4699326, 4712539, 4728219, 4745242, 4762652, 4778309, 4786884, 4795459, 4804034, 4818370, 4830326, 4842771, 4855221, 4863187, 4871153, 4879119, 4889191, 4899972, 4907087, 4916576, 4921739, 4926902, 4932065, 4939832, 4946650, 4956211, 4962522, 4965641, 4968760, 4971879, 4977407, 4983025, 4987788, 4992228, 4994829, 4997430, 5000031, 5003292, 5007015, 5011090, 5014312, 5016308, 5018304, 5020300, 5022750, 5025590, 5028621, 5031367, 5033047, 5034727, 5036407, 5038697, 5041458, 5043858, 5045895, 5047319, 5048743, 5050167, 5051968, 5054271, 5056078, 5058387, 5059663, 5060939, 5062215, 5063594, 5064973, 5066905, 5069153, 5070650, 5072147, 5073644, 5075533, 5078061, 5079942, 5082498, 5083993, 5085488, 5086983, 5088909, 5091441, 5093653, 5095914, 5097369, 5098824, 5100279, 5101734, 5104021, 5107312, 5110405, 5112544, 5114683, 5116822, 5120052, 5123282, 5127568, 5131921, 5135187, 5138453, 5141719, 5145810, 5152477, 5158792, 5165428, 5170720, 5176012, 5181304, 5188081, 5196608, 5205866, 5215778, 5223415, 5231052, 5238689, 5248950, 5259486, 5273986, 5287724, 5298676, 5309628, 5320580, 5331532, 5344738, 5357944, 5375039, 5391640, 5408241, 5424842, 5450978, 5478118, 5507018, 5540377, 5566945, 5593513, 5620081, 5669904, 5729945, 5802857, 5856512, 5910167, 5963822, 6017477, 6117148, 6217908, 6379596, 6472788, 6565980, 6659172, 6752364, 6870139, 7007319, 7128539, 7249759, 7347224, 7444689, 7542154, 7677096, 7856221, 8015382, 8177890, 8288379, 8398868, 8509357, 8603829, 8761770, 8919217, 9060312, 9162123, 9263934, 9365745, 9480622, 9614175, 9745063, 9863985, 9924693, 9985401, 10046109, 10123982, 10210204, 10284572, 10333511, 10382450, 10431389, 10480328, 10524159, 10586998, 10640053, 10689057, 10711959, 10734861, 10757763, 10792143, 10829251, 10863464, 10894079, 10910338, 10926597, 10942856, 10965049, 10998961, 11034853, 11062380, 11077020, 11091660, 11106300];
        const N_POBLACION = 47370000;
        const DIAS_RECUPERACION = 10;

        const TOTAL_DIES_GRAFIC = llista_casos_hist.length; // Longitud total de les dades històriques

        // Ajustar el rang màxim del lliscador de dies dinàmicament
        rangDia.max = TOTAL_DIES_GRAFIC > 0 ? TOTAL_DIES_GRAFIC - 1 : 0;
        rangDia.value = Math.min(rangDia.max, 150); // Valor inicial raonable

        // --- Funció JavaScript que replica *exactament* la teva `estimacio_pandemia` de Python ---
        function estimacio_pandemia_js(beta_val, dia_inici_idx) { // dia_inici_idx és l'índex (base 0)
            // Assegurar-se que el dia d'inici sigui vàlid
            if (dia_inici_idx < 0 || dia_inici_idx >= TOTAL_DIES_GRAFIC) {
                console.error("Dia d'inici fora de rang.");
                return { S: [], I: [], R: [], nous_casos: [] };
            }

            // Dades fins al dia d'inici (inclòs)
            const casos_nous_diaris_proj = [...llista_casos_hist.slice(0, dia_inici_idx + 1)];
            const susceptibles_proj = [...S_hist.slice(0, dia_inici_idx + 1)];
            const infectats_proj = [...I_hist.slice(0, dia_inici_idx + 1)];
            const recuperats_proj = [...R_hist.slice(0, dia_inici_idx + 1)];

            // Simulació per als dies restants, des del dia d'inici + 1
            for (let i = dia_inici_idx + 1; i < TOTAL_DIES_GRAFIC; i++) {
                // Últims valors disponibles per calcular el següent pas
                const prev_S = susceptibles_proj[susceptibles_proj.length - 1];
                const prev_I = infectats_proj[infectats_proj.length - 1];
                const prev_R = recuperats_proj[recuperats_proj.length - 1];

                // Càlcul de noves infeccions (pas de S a I) per a aquest dia
                let nous_infectats_avui;
                if (prev_S <= 0 || prev_I <= 0) {
                    nous_infectats_avui = 0;
                } else {
                    nous_infectats_avui = (beta_val * prev_S * prev_I / N_POBLACION);
                }
                casos_nous_diaris_proj.push(nous_infectats_avui);

                // Càlcul d'I (Infectats actius) i R (Recuperats)
                const inici_recuperacio_idx = Math.max(0, casos_nous_diaris_proj.length - DIAS_RECUPERACION);

                const current_I_sum = casos_nous_diaris_proj.slice(inici_recuperacio_idx, casos_nous_diaris_proj.length).reduce((a, b) => a + b, 0);
                infectats_proj.push(current_I_sum);

                const current_R_sum = casos_nous_diaris_proj.slice(0, inici_recuperacio_idx).reduce((a, b) => a + b, 0);
                recuperats_proj.push(current_R_sum);

                // Càlcul de S (Susceptibles)
                let current_S = N_POBLACION - current_I_sum - current_R_sum;
                current_S = Math.max(0, current_S); // Assegurar que S no sigui negatiu
                susceptibles_proj.push(current_S);

                // Si els infectats baixen molt, assumim que la pandèmia s'ha extingit en la projecció
                if (current_I_sum < 0.1 && i > dia_inici_idx + DIAS_RECUPERACION) {
                    // Omplir la resta dels dies amb valors estables de final d'epidèmia
                    for (let j = i + 1; j < TOTAL_DIES_GRAFIC; j++) {
                        casos_nous_diaris_proj.push(0);
                        infectats_proj.push(0);
                        recuperats_proj.push(N_POBLACION - susceptibles_proj[susceptibles_proj.length - 1]);
                        susceptibles_proj.push(susceptibles_proj[susceptibles_proj.length - 1]);
                    }
                    break;
                }
            }

            return {
                S: susceptibles_proj,
                I: infectats_proj,
                R: recuperats_proj,
                nous_casos: casos_nous_diaris_proj
            };
        }

        // --- Funció principal d'actualització del gràfic ---
        function actualitzarGrafic() {
            const dia_seleccionat_idx = parseInt(rangDia.value); // Índex del dia d'inici (base 0)
            const valor_beta = parseFloat(rangBeta.value);

            valorDiaSpan.textContent = dia_seleccionat_idx;
            valorBetaSpan.textContent = valor_beta.toFixed(3); // Mostrar beta amb 3 decimals

            // Obtenir les dades projectades usant la funció adaptada
            const dades_projectades = estimacio_pandemia_js(valor_beta, dia_seleccionat_idx);

            // Crear l'eix X (dies)
            const x_dades = Array.from({length: TOTAL_DIES_GRAFIC}, (_, i) => i);

            // Determinar el rang màxim de l'eix Y dinàmicament
            let val_maxim_Y = Math.max(...I_hist, ...dades_projectades.I);
            val_maxim_Y = val_maxim_Y * 1.1; // Un 10% més per a marge superior
            if (val_maxim_Y === 0 || isNaN(val_maxim_Y) || !isFinite(val_maxim_Y)) {
                val_maxim_Y = N_POBLACION * 0.001; // Valor predeterminat si no hi ha dades significatives
            }

            // Configuració dels Traces per a Plotly
            const traces = [
                // Infectats Reals (de l'històric real del teu Python)
                {
                    x: x_dades,
                    y: I_hist,
                    mode: 'lines',
                    name: 'Infectats Reals',
                    line: { color: 'red', width: 3, dash: 'solid' },
                    showlegend: true // Visible i a la llegenda
                },
                // Infectats Projectats
                {
                    x: x_dades,
                    y: dades_projectades.I,
                    mode: 'lines',
                    name: `Projecció Infectats (beta = ${valor_beta.toFixed(3)} des del Dia ${dia_seleccionat_idx})`,
                    line: { color: 'blue', width: 3, dash: 'dash' },
                    showlegend: true // Visible i a la llegenda
                },
                // Aquestes corbes NO apareixeran a la llegenda ni seran visibles per defecte.
                {
                    x: x_dades,
                    y: llista_casos_hist,
                    mode: 'lines',
                    name: 'Nous Casos Diaris (Històric)',
                    line: { color: 'orange', width: 2, dash: 'dot' },
                    visible: false,
                    showlegend: false
                },
                {
                    x: x_dades,
                    y: dades_projectades.nous_casos,
                    mode: 'lines',
                    name: `Proj. Nous Casos ($\\beta = ${valor_beta.toFixed(3)}$ des del Dia ${dia_seleccionat_idx})`,
                    line: { color: 'gold', width: 2, dash: 'dashdot' },
                    visible: false,
                    showlegend: false
                },
                {
                    x: x_dades,
                    y: S_hist,
                    mode: 'lines',
                    name: 'Susceptibles (Històric)',
                    line: { color: 'darkblue', width: 1 },
                    visible: false,
                    showlegend: false
                },
                {
                    x: x_dades,
                    y: R_hist,
                    mode: 'lines',
                    name: 'Recuperats (Històric)',
                    line: { color: 'darkgreen', width: 1 },
                    visible: false,
                    showlegend: false
                },
                {
                    x: x_dades,
                    y: dades_projectades.S,
                    mode: 'lines',
                    name: `Proj. Susceptibles ($\\beta = ${valor_beta.toFixed(3)}$ des del Dia ${dia_seleccionat_idx})`,
                    line: { color: 'lightblue', width: 1, dash: 'dash' },
                    visible: false,
                    showlegend: false
                },
                {
                    x: x_dades,
                    y: dades_projectades.R,
                    mode: 'lines',
                    name: `Proj. Recuperats ($\\beta = ${valor_beta.toFixed(3)}$ des del Dia ${dia_seleccionat_idx})`,
                    line: { color: 'lightgreen', width: 1, dash: 'dash' },
                    visible: false,
                    showlegend: false
                }
            ];

            const layout = {
                title: `Corbes d'Infectats: Històric Real vs. Projecció des del Dia ${dia_seleccionat_idx}`,
                xaxis: {
                    title: 'Dia',
                    range: [0, TOTAL_DIES_GRAFIC - 1],
                    dtick: 50 // Mostrar ticks cada 50 dies
                },
                yaxis: {
                    title: 'Nombre d\'individus',
                    range: [0, val_maxim_Y]
                },
                shapes: [ // Línia vertical per al dia d'inici de la projecció
                    {
                        type: 'line',
                        x0: dia_seleccionat_idx,
                        y0: 0,
                        x1: dia_seleccionat_idx,
                        y1: val_maxim_Y,
                        line: {
                            color: 'grey',
                            width: 2,
                            dash: 'dot'
                        }
                    }
                ],
                hovermode: 'x unified',
                legend: {
                    x: 0.01,
                    y: 0.99,
                    bgcolor: 'rgba(255, 255, 255, 0.7)',
                    bordercolor: '#ccc',
                    borderwidth: 1
                }
            };

            Plotly.newPlot(graficSIRDiv, traces, layout);
        }

        // Event listeners per actualitzar el gràfic quan qualsevol lliscador canvia
        rangDia.addEventListener('input', actualitzarGrafic);
        rangBeta.addEventListener('input', actualitzarGrafic);

        // Inicialitzar el gràfic en carregar la pàgina
        actualitzarGrafic();
    </script>
</body>
</html>
